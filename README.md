# SM30 功能增强插件

**作者**：ABAP 老白

![](img\pic1.png)

![](img\pic2.gif)

**更多功能请查看原文链接**：https://mp.weixin.qq.com/s/ByNUYR00GWv3XHhaz2JvGg


## 一、插件背景

SAP 标准事务码 SM30 是配置表维护的核心工具，但存在**功能贫乏**的问题，无查找、排序、导入、导出、批量修改、更改日志等关键功能，面对上万条数据的维护场景时，只能逐屏粘贴操作，效率极低。

本插件针对 SM30 的上述痛点进行全面增强，实现一站式表维护高效操作，同时支持标准配置表和自定义表的功能扩展。

## 二、核心增强功能

1. **批量导入**：导出 Excel 模板，填写数据后一键导入，自动去重主键重复数据
2. **灵活排序**：光标定位目标列，点击排序按钮即可实现该列升 / 降序排列
3. **智能搜索**：CHAR 类型字段模糊搜索、数值 / 日期类型字段精确搜索，支持 Ctrl+F 搜索、Ctrl+G 查找下一条
4. **数据导出**：支持导出制表符分隔的文本文件，可选择导出选中行 / 全部行
5. **ALV 查看**：集成 ALV 视图，提升数据展示和操作体验
6. **批量修改**：光标定位目标列，可选择修改选中行 / 全部行的该列值
7. **更改日志**：记录所有表维护的操作日志，包含修改日期、账号、操作内容等
8. **工具栏优化**：新增功能对应的工具栏按钮，操作更直观

## 三、适用范围

- 自定义表：需为表创建**维护视图**（不支持直接对表做 SM30，不支持视图簇）
- 标准配置表：如物料组维护视图 V023 等，直接通过插件一键扩展

## 四、实现步骤（自定义表示例：ZSM30）

### 4.1 基础准备

1. 创建自定义透明表 ZSM30，包含客户端、工厂、物料编号、供应商、数量、计量单位等字段
2. 为 ZSM30 创建维护视图 ZSM30V
3. 通过**表格维护生成器**为 ZSM30V 生成维护对话，设置权限组、函数组、维护屏幕等基础信息

### 4.2 工具栏按钮扩展

1. 复制表格维护生成器的原有 Status
2. 在用户接口中添加新增功能对应的按钮（EALX、ESLG、EULG 等核心按钮）
3. 维护功能键映射，完成工具栏界面改造

### 4.3 功能代码开发

1. 在函数池 SAPLZSM30V 中引入自定义包含文件 ZSM30ADDONI01，封装所有增强功能的核心逻辑

2. 编写关键模块：

   - `hide_position_button`：灰掉排序后失效的定位按钮
   - `zsm30addon_command`：处理搜索、排序等功能的按钮事件

   

3. 在屏幕绘制器中添加 MODULE 调用，关联功能按钮与后台代码

4. 为表格维护生成器添加**SAVESM30LOG**事件，实现更改日志记录

### 4.4 功能测试

1. **批量导入**：导出模板→Excel 填写数据→复制粘贴→一键导入，自动去重
2. **排序**：光标定位目标列，点击排序按钮完成列排序
3. **搜索**：光标定位目标列，使用搜索按钮 / Ctrl+F 实现精准 / 模糊搜索
4. **导出 / ALV**：选择行 / 全量行，实现文本导出或 ALV 视图展示
5. **批量修改**：定位目标列，选择修改范围后一键更新
6. **日志查看**：通过 SM30 修改日志界面，查看所有操作记录

## 五、标准配置表快速扩展方法

针对 SAP 标准配置表（如物料组 OMSF），无需重复开发，直接通过插件一键实现功能增强：

1. 运行程序**ZSM30ADDON**
2. 填入标准配置表对应的**维护视图名称**（如物料组维护视图 V023）
3. 勾选需要的功能：工具栏添加按钮、屏幕流添加 MODULE、记录 SM30 修改日志
4. 执行程序，自动完成标准配置表的 SM30 功能增强
5. 重新打开对应事务码（如 OMSF），即可使用所有增强功能

## 六、插件部署

1. 作者已将插件所有程序、表、配置打包至传输请求中
2. 使用程序**ZMIGRATEREQUEST**导入该传输请求，即可完成插件部署
3. 部署后支持所有符合要求的表 / 维护视图直接使用增强功能

## 七、插件包含对象

| 类型     | 名称          | 说明                             |
| :------- | :------------ | :------------------------------- |
| 程序     | ZSM30ADDON    | 核心增强程序，一键扩展 SM30 功能 |
| 包含文件 | ZSM30ADDONI01 | 封装增强功能核心逻辑             |
| 程序     | ZSM30LOG      | 更改日志相关程序                 |
| 表       | ZSM30LOG      | 存储 SM30 修改日志数据           |
| 自定义表 | ZSM30         | 功能测试示例表                   |
| 维护视图 | ZSM30V        | ZSM30 对应的维护视图             |

## 八、使用效果

- 上万条数据的批量导入从**通宵逐屏粘贴**变为**瞬间完成**
- 各类数据维护操作无需繁琐手动操作，效率提升超 90%
- 操作日志全程记录，满足合规审计要求
- 标准配置表无需二次开发，一键赋能所有增强功能